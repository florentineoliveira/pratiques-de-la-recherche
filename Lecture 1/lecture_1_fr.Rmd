---
title: "Lecture 0: `R`efresher"
subtitle: "Pratiques de la Recherche en √âconomie"
author: "Florentine Oliveira"
date: "`r Sys.Date()`"
output:
  xaringan::moon_reader:
    lib_dir: libs
    css: xaringan-themer.css
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      ratio: "16:9"
---

```{r setup, include = FALSE, warning = FALSE, message = FALSE}
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(
  message = FALSE,
  warning = FALSE,
  dev = "svg",
  cache = TRUE,
  fig.align = "center"
  #fig.width = 11,
  #fig.height = 5
)

# Load packages
library(tidyverse)
library(pander)
library(ggthemes)
library(gapminder)
library(emo)
library(countdown)
library(xaringanthemer)
library(xaringanExtra)
library(sf)

# countdown style
countdown(
  color_border              = "#dd0747",
  color_text                = "black",
  color_running_background  = "#dd0747",
  color_running_text        = "white",
  color_finished_background = "white",
  color_finished_text       = "#dd0747",
  color_finished_border     = "#dd0747",
  font_size = "2em" 
)


style_xaringan( 
  title_slide_background_color = "#dd0747",
  title_slide_text_color = "white",
  text_color = "black",
  header_color = "#dd0747",
  text_bold_color = "#dd0747",
  text_slide_number_color = "black",
  code_inline_background_color = "#e0e1df",
  base_font_size = "24px",
  text_font_family = "Palatino",
  header_font_family = "Palatino",
  header_h1_font_size = "45px",
  header_h2_font_size = "35px",
  header_h3_font_size = "28px",
  inverse_background_color = "#f8cdda",
  inverse_text_color = "black",
  inverse_header_color = "#dd0747")

# Theme with only x and y axis ans names
theme_minimum = theme_bw() + 
  theme(
  text = element_text(family = "Palatino"),
  line = element_blank(),  # Masquer toutes les lignes par d√©faut
  rect = element_blank(),  # Masquer tous les rectangles par d√©faut
  axis.line = element_line(color = "black"),  # Afficher les lignes des axes
  axis.ticks = element_blank(),  # Masquer les ticks des axes
  plot.title = element_blank(),  # Masquer le titre du graphique
  panel.background = element_blank(),  # Masquer le fond du panneau
  panel.grid.major = element_blank(),  # Masquer la grille principale
  panel.grid.minor = element_blank(),  # Masquer la grille secondaire
  plot.background = element_blank(),  # Masquer le fond du graphique
  legend.position = "none"  # Masquer la l√©gende
)

# A blank theme for ggplot
theme_empty = theme_bw() + 
  theme(
  text = element_text(family = "Palatino"),
  line = element_blank(),  # Masquer toutes les lignes par d√©faut
  rect = element_blank(),  # Masquer tous les rectangles par d√©faut
  axis.line = element_line(color = "black"),  # Afficher les lignes des axes
  axis.ticks = element_blank(),  # Masquer les ticks des axes
  axis.text = element_blank(),  # Masquer les √©tiquettes des axes
  axis.title = element_text(size = 12),  # Afficher les titres des axes
  plot.title = element_blank(),  # Masquer le titre du graphique
  panel.background = element_blank(),  # Masquer le fond du panneau
  panel.grid.major = element_blank(),  # Masquer la grille principale
  panel.grid.minor = element_blank(),  # Masquer la grille secondaire
  plot.background = element_blank(),  # Masquer le fond du graphique
  legend.position = "none"  # Masquer la l√©gende
)


```

layout: true


---
# About me

&nbsp;


Doctorante en √âconomie √† PSE en 3√®me ann√©e

Champs de recherche: √©conomie de la famille, de l'√©ducation, du travail


&nbsp;

&nbsp;

.center[
**Me contacter**: florentine.oliveira@psemail.eu

**Si vous avez des questions ou envie/besoin de parler**: Campus Jourdan, Bureau R4-54 
]

---
# Objectifs du cours

&nbsp;

&nbsp;

- Se familiariser avec 
  - les techniques **√©conom√©triques** de base
  - la **recherche** en **√©conomie appliqu√©e**

- Apprendre le language de programmation `R`

&nbsp;

$\implies$ pour pouvoir r√©aliser votre **m√©moire** !



---
# Roadmap


&nbsp;


### Semestre 1

1. S√©ance 1 (aujourd'hui): Rappels de `R` 
2. S√©ance 2 (): R√©diger en $\LaTeX$
3. S√©ance 3 (): Statistiques Descriptives

### Semestre 2
4. S√©ance 4 (): R√©gressions lin√©aires simples et multiples
5. S√©ance 5 (): M√©thode des variables instrumentales
6. S√©ance 6 (): Doubles-Diff√©rences (DiD)
7. S√©ance 7 (): Regression Discontinuity Design
8. S√©ance 8 ():


---
# Validation du cours

## DM


## M√©moire


---
# Cette s√©ance

&nbsp;

1. La recherche en √©conomie appliqu√©e

2. `R`: rappels et **trouver mot**

  2.1. D√©finition, usages, interface  
  2.2. Projet `R`   
  2.3. Importer des donn√©es   
  2.4. Manipulation des donn√©es avec `dplyr`   
  2.5. Visualisation des donn√©es avec `ggplot`   
  2.6. Maps
  
---
# 1. La recherche en √©conomie appliqu√©e

###  Qu'est-ce que la recherche en √©conomie appliqu√©e?

- R√©pondre √† des **questions de recherche** pour apprendre sur les comportements humains, l'efficacit√© des poliques publiques, ...

  - Grande diversit√© des champs de recherche: √©ducation, travail, famille, environnement, macro√©conomie, politique, migration, genre, urban, crime, √©conomie historique, ...
  
  
- ... en utilisant des techniques statistiques rigoureuses (= **√©conom√©trie**) ...


- ... et des donn√©es!


- `R` est un logiciel qui permet de r√©aliser ces analyses descriptives et empiriques.

---
# 1. La recherche en √©conomie appliqu√©e

### Quelques exemples de questions de recherche 

- Quel est l'effet des bourses de scolarit√© **sur** la r√©ussite scolaire? 

- Quel est l'effet d'un allongement de la dur√©e du cong√© parental **sur** la participation au march√© du travail des m√®res?

- Quelle est l'ampleur de la discrimination dans le processus de recrutement?

- Quel est l'effet d'un assouplissement des conditions d'√©ligibilit√© √† l'assurance ch√¥mage **sur** l'emploi?

- Quel est l'effet de la pollution atmosph√©rique **sur** la productivit√©?  

- Quel est le r√¥le des m√©dias **sur** le comportement de vote?

- Quel est l'effet de la densit√© de population **sur** les salaires?

---
# 1. La recherche en √©conomie appliqu√©e

.center[
## `r emo::ji("rotating_light")` Corr√©lation $\neq$ causalit√© 
]


---
layout: false
class: center, middle, inverse

# R

---
# 2. `R`: rappels et **trouver mot** 


## 2.1. `R`ecap : D√©finition, usages, interface

- D'apr√®s le site internet de `R` : *R is a free software environment for statistical computing and graphics.*

  - un logiciel (interface R studio)
  
  - un language de programmation
  
- `R` est **gratuit** et en **open source**

  - donc utilis√© par beaucoup de monde dans les milieux acad√©mique insitutionnel

- Logiciel tr√®s **polyvalent**

  - statistiques decriptives, analyses √©conom√©triques, analyse de donn√©es spaciales, ML, Rmarkdown

- Comp√©tence valorisable et de plus en plus appr√©ci√©e (public & priv√©)   


---
### Popularit√© de `R`<sup>1</sup>

.pull-left[
```{r popularity scholar, echo=FALSE, out.width="150%"}
knitr::include_graphics("imgs/popularity_datascientist.jpg")
```
]

.pull-right[
```{r popularity data, echo=FALSE, out.width="80%"}
knitr::include_graphics("imgs/popularity_scholar.png")
```
]

.footnote[
[1]: [The Popularity of Data Science Software](https://r4stats.com/articles/popularity/)
]

---
## 2.1. `R`ecap : D√©finition, usages, interface

```{r interface, echo=FALSE, out.width="80%"}
knitr::include_graphics("imgs/interface.png")
```


---
## 2.2. `R`ecap : Projet `R`

Les projets `R` permettent une meilleure organisation de votre travail.
.pull-left[
```{r rproj, echo=FALSE, out.width="60%"}
knitr::include_graphics("imgs/rproj.jpeg")
```
]

.pull-right[
**Cr√©ation d'un projet `R`:** 
- Dans R-Studio  

  - Fichier $\rightarrow$ Nouveau projet  

]


---
class: inverse
# Application: cr√©er votre projet `R`

`r countdown(minutes = 3, top = 0)`

.pull-left[
```{r application rproj , echo=FALSE, out.width="70%"}
knitr::include_graphics("imgs/rproj_sans_fond.png")
```
]

.pull-right[
Cr√©er un projet R pour la Lecture 1 en respectant cette structure
]



---
## 2.3. `R`ecap: Importer des donn√©es

**Format .csv:**

- `read.csv()` ou `read.cvs2()` avec l'argument `sep = ';'`

&nbsp;

**Formats .dta (stata), .sas7bdat (sas): ** package `haven` (nb: `haven` est inclus dans `tidyverse`)

  - `.dta` : `read_dta()`
  
  - `.sas7dbat` : `read_sas()`
  
&nbsp;

**Format .xls ou .xlsx (Excel): ** package `readxl`

  - `read_excel()`  
  
---
## 2.3. `R`ecap: Importer des donn√©es

&nbsp;

**Format .rds:** format de donn√©es le moins lourd et optimal pour travailler sur R, surtout quand les bases de donn√©es sont tr√®s volumineuses

- `readRDS()`

**Conseil**: √† la fin du script de cleaning, enregistrer le ou les data.frames nettoy√©s en format `.RDS` avec la fonction `saveRDS()` et importer ces donn√©es nettoy√©es dans le script sur lequel vous ferez toutes vos analyses.
  
  
---
## `R`ecap: Manipulation et visualisation des donn√©es

Principal package pour la manipulation et visualitation des donn√©es : `dplyr`

$$\text{data.frame} \;\; \underbrace{\text{%>%}}_{\text{pipe}} \;\; \text{function}(\text{your action})$$

[Cheatsheet Dplyr](#)

--
### Principales fonctions 

- `mutate()`: cr√©er ou modifier des variables
- `summarise()`: r√©sume les donn√©es par des statistiques descriptives 
- `filter()`: conserve ou supprime les lignes 
- `group_by()`: permet de grouper des observations entre elles 
- `select()`: consevre ou supprime des colonnes
- `arrange()`: ordonne les observations par rapport aux valeurs d'une colonne

---
class: inverse
# Application : Titanic

Ce jeu de donn√©es fournit des informations sur le sort des passagers du paquebot ¬´ Titanic ¬ª, r√©sum√©es en fonction du statut √©conomique (class), du sexe, de l'√¢ge et de la survie.

```{r, echo = T}

titanic = as.data.frame(Titanic)

head(titanic)

```

---
class: inverse
# Application : Titanic

`r countdown(minutes = 5, top = 0)`

&nbsp;


1. Calculer le taux de survie par classe, par sexe, et par √¢ge

2. Cr√©er une variable `passenger` qui vaut 1 si l'individu n'est pas un membre d'√©quipage (*crew*), 0 si c'est un membre d'√©quipage

3. Cr√©er une table qui r√©sume, pour les adultes uniquement, le taux de survie par classe x Sexe et ordonner par ordre d√©croissant

---
background-color: #fbe6ec
# Solution : Titanic

1. Calculer le taux de survie par classe, par sexe, et par √¢ge

```{r, echo = T}

titanic %>% 
  group_by(Class) %>% #<< 
  summarise(tx_survie = sum(Freq[Survived == "Yes"])/sum(Freq)) %>% 
  ungroup()

```

---
background-color: #fbe6ec
count: false
# Solution : Titanic

1. Calculer le taux de survie par classe, par sexe, et par √¢ge

```{r, echo = T}

titanic %>% 
  group_by(Class) %>% 
  summarise(tx_survie = sum(Freq[Survived == "Yes"])/sum(Freq)) %>% #<< 
  ungroup()

```

---
background-color: #fbe6ec
# Solution : Titanic

1. Calculer le taux de survie par classe, par sexe, et par √¢ge

```{r, echo = T}

titanic %>% 
  group_by(Sex) %>% 
  summarise(tx_survie = sum(Freq[Survived == "Yes"])/sum(Freq)) %>% 
  ungroup()

```


---
background-color: #fbe6ec
# Solution : Titanic

1. Calculer le taux de survie par classe, par sexe, et par √¢ge

```{r, echo = T}

titanic %>% 
  group_by(Age) %>% 
  summarise(tx_survie = sum(Freq[Survived == "Yes"])/sum(Freq)) %>% 
  ungroup()

```


---
background-color: #fbe6ec
# Solution : Titanic

2. Cr√©er une variable `passenger` qui vaut 1 si l'individu n'est pas un membre d'√©quipage (*crew*), 0 si c'est un membre d'√©quipage

```{r, results = 'hide'}

# Solution 1
titanic %>% 
  mutate(passenger = ifelse(Class != "Crew", 1, 0))

# Solution 2
titanic %>% 
  mutate(passenger = case_when(Class != "Crew" ~ 1,
                               Class == "Crew" ~ 0))

```

**Conseil**: utiliser `case_when` quand il y a plus d'une condition.

---
background-color: #fbe6ec
# Solution : Titanic

3. Cr√©er une table qui r√©sume, pour les adultes uniquement, le taux de survie par classe x Sexe et ordonner par ordre d√©croissant

```{r, echo = T, results = 'hide'}

titanic %>%
  filter(Age == "Adult") %>%
  group_by(Class, Sex) %>%
  summarise(tx_survie = sum(Freq[Survived == "Yes"]) / sum(Freq)) %>%
  arrange(desc(tx_survie))

```




---
### Left-right-full-anti joints



---
### Formats wide et long

---
class: inverse
## Application : √âlections l√©gislatives de 2024 en France 

`r countdown(minutes = 5, top = 0)`

1. Importer les donn√©es

2. Calculer le taux d'absention moyen par d√©partement

3. Calculer le taux de participation moyen des villes dont le code postal termine par un 7


---
background-color: #fbe6ec
# Solution


```{r , echo = F, message = F, warning = F, include = F}

# 1. Import data 

resultats_t1 = read.csv("data/resultats-definitifs-par-circonscription-t1.csv", sep = ";", na.strings=c("","NA")) 
resultats_t2 = read.csv("data/resultats-definitifs-par-circonscription-t2.csv", sep = ";", na.strings=c("","NA")) 

 
# 1. Pivorter les deux dataframe en format long et ajouter pour chacun une colonne 'tour' qui vaut 1 pour le premier tour et 2 pour le second tour

resultats_t1_long <- resultats_t1 %>%
  pivot_longer(
    cols = matches(".*\\.[1-9]$|.*\\.[1][0-9]$"),  # S√©lectionne les variables avec suffixes .1 √† .19
    names_to = c(".value", "candidate_number"),
    names_pattern = "(.*)\\.(\\d+)"
  ) %>%
  mutate(tour = 1) %>% 
  filter(!is.na(Nom.candidat))


resultats_t2_long = resultats_t2 %>%
  pivot_longer(
    cols = matches(".*\\.[1-4]$"),  # S√©lectionne les variables avec suffixes .1 √† .4
    names_to = c(".value", "candidate_number"),
    names_pattern = "(.*)\\.(\\d+)"
  ) %>%
  mutate(tour = 2) %>% 
  filter(!is.na(Nom.candidat))


# 2. Fusionner les deux dataframe par les lignes et ne conserver que les observations des candidats √©lus
resultats = rbind(resultats_t1_long, resultats_t2_long) %>% 
  filter(Elu == "√©lu")

```






---
class: inverse
## Application: Carte des r√©sultats du 2nd tour des l√©gislatives 2024

`r countdown(minutes = 10, top = 0)`



```{r carte r√©sultats, echo = F, message = F, warning = F, include = F}

# Import data 

map = st_read("data/france-circonscriptions-legislatives-2012.shp") %>% 
  rename(CODDPT = code_dpt,
         CODCIRLG = num_circ)

results = read.csv("data/legislatives-2024-candidats-elus-france-entiere-tour-1-2-2024.csv", sep = ";") %>% 
  mutate(CODCIRLG = as.character(CODCIRLG),
         CODDPT = ifelse(nchar(CODDPT) == 1, paste0("0", CODDPT), CODDPT)) %>% 
  left_join(map , by = c("CODDPT", "CODCIRLG"))

ggplot(results %>% filter(! (CODDPT %in% c("971", "972", "973", "974", "975", "976", "986", "987", "988", "ZX", "ZZ")))) +
  geom_sf(aes(fill = CODE_NUA, geometry = geometry)) +
  theme_minimal() +
  labs(title = "R√©sultats des √©lections l√©gislatives par circonscription",
       fill = "Parti") +
  theme(legend.position = "bottom", 
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        panel.grid = element_blank())


```





---
name: bestfriend
# Vos 4 meilleurs amis


1. La **commande** `help(.)` ou `?.`

--

2. Les ***cheatsheets***
  - [Exemple](#cheatR)

--

3. **Internet** (stackoverflow): 

  - vous ne serez jamais la premi√®re personne √† rencontrer les probl√®mes auxquels vous faites face
  - copier/coller le message d'erreur peut suffire, mais essayez de comprendre par vous m√™me d'abord
  
--

4. **ChatGPT**: devient de plus en plus performant pour r√©soudre les probl√®mes de codes. 
  - ‚ö†Ô∏è souvent les packages ne sont pas √† jour, les fonctions propos√©es invent√©es

--

ü§ùÔ∏è Soyez autonomes: ne demander de l'aide √† vos camarades (ou √† moi) uniquement apr√®s avoir demand√© √† vos 4 meilleurs amis!




---
# Bonnes pratiques

### Organisation du travail

- Un dossier pour chaque projet de recherche

  - Scripts
    - un scripts par t√¢che: cleaning, statistiques descriptives, anlayse empirique
  
  - Data
    - `.rds`
  
  - Figures
  
  - (Admin)
  


---
### Commenter son code pour vous-m√™me...<sup>1</sup>

```{r meme1, echo=FALSE, out.width="60%"}
knitr::include_graphics("imgs/meme_comment_code.jpeg")
```

---
### ... et vos coll√®gues<sup>1</sup>

```{r meme2, echo=FALSE, out.width="60%"}
knitr::include_graphics("imgs/headache.png")
```


---
### **Essayer** de ne pas s'√©nerver<sup>1</sup>

.pull-left[
```{r meme3, echo=FALSE, out.width="70%"}
knitr::include_graphics("imgs/parenthesis.jpeg")
```
]
.pull-right[
L'apprentissage de `R` est long et fastidieux, mais les rendements sont croissants!
.footnote[
[1]: R Memes For Statistical Fiends
]
]


---
# Cheatsheets

- [test1](https://rstudio.github.io/cheatsheets/rstudio-ide.pdf)
- [test](https://posit.co/resources/cheatsheets/)

---
name: cheatR
class: center, middle
```{r cheatR, echo=FALSE, out.width="110%"}
knitr::include_graphics("imgs/cheatsheetR.png")
```
[Back](#bestfriend)




